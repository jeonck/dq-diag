"""
이론적 프레임워크 모듈
데이터 품질 관리 이론 및 개념 설명
"""

import streamlit as st


def show_theoretical_framework():
    """데이터 품질 관리 이론적 프레임워크 표시"""

    st.title("📚 데이터 품질 관리 이론 프레임워크")

    st.markdown("""
    공공데이터 품질관리 매뉴얼을 기반으로 한 데이터 품질 관리의 이론적 배경과
    실무 적용 방법을 제공합니다.
    """)

    # 1. 데이터 품질의 정의
    st.header("1️⃣ 데이터 품질이란?")

    st.markdown("""
    **데이터 품질(Data Quality)**은 데이터가 의도된 용도에 얼마나 적합한지를 나타내는 지표입니다.

    > "고품질 데이터란 사용자가 원하는 목적에 부합하며, 정확하고 일관되며 완전한 데이터"

    ### 데이터 품질이 중요한 이유:
    - 🎯 **의사결정 품질 향상**: 정확한 데이터 → 올바른 의사결정
    - 💰 **비용 절감**: 데이터 오류로 인한 손실 방지
    - 📈 **업무 효율성 증대**: 데이터 정제 시간 감소
    - 🔒 **법적 리스크 감소**: 개인정보 보호법 등 준수
    - 🤝 **신뢰성 확보**: 데이터 기반 서비스의 신뢰도 향상
    """)

    # 2. 7대 품질 지표
    st.header("2️⃣ 7대 데이터 품질 지표")

    st.markdown("""
    데이터 품질을 종합적으로 평가하기 위한 7가지 핵심 지표입니다.
    """)

    # 준비성
    with st.expander("📌 1. 준비성 (Availability)"):
        st.markdown("""
        **정의**: 데이터가 필요한 시점에 접근 가능한 정도

        **측정 항목**:
        - 데이터 접근 가능 여부
        - 시스템 가용성
        - 데이터 접근 권한 설정

        **진단 방법**:
        - 결측치(NULL, 빈 값) 검사
        - 시스템 접근성 테스트

        **실무 예시**:
        ✅ **좋은 사례**: 모든 필드에 데이터가 존재하고 시스템이 24시간 가용
        ❌ **나쁜 사례**: 중요 필드에 NULL 값이 많고 시스템 장애 빈발

        **개선 방안**:
        - 필수 입력 항목 지정
        - 기본값(default) 설정
        - 백업 시스템 구축
        """)

    # 완전성
    with st.expander("📌 2. 완전성 (Completeness)"):
        st.markdown("""
        **정의**: 누락된 값이나 속성이 없는 정도

        **측정 항목**:
        - NULL 값 비율
        - 필수 속성 존재 여부
        - 레코드 완전성

        **진단 방법**:
        - 완전성 비율 = (전체 셀 - NULL 셀) / 전체 셀 × 100%
        - 기본키(PK) 존재 여부
        - 필수 컬럼 채워짐 비율

        **실무 예시**:
        ✅ **좋은 사례**: 고객 테이블의 모든 필수 정보(이름, 연락처 등) 완비
        ❌ **나쁜 사례**: 주문 테이블의 30%가 배송지 정보 누락

        **개선 방안**:
        - NOT NULL 제약 조건 설정
        - 입력 폼 필수 항목 지정
        - 데이터 수집 프로세스 개선
        """)

    # 고유성
    with st.expander("📌 3. 고유성 (Uniqueness)"):
        st.markdown("""
        **정의**: 중복되지 않은 고유한 데이터의 정도

        **측정 항목**:
        - 중복 레코드 수
        - 고유값 비율
        - 중복 발생 빈도

        **진단 방법**:
        - 중복률 = 중복 레코드 수 / 전체 레코드 수 × 100%
        - 고유성 비율 = 1회만 나타나는 값 / 전체 값 × 100%

        **실무 예시**:
        ✅ **좋은 사례**: 회원 ID가 모두 고유하여 중복 없음
        ❌ **나쁜 사례**: 동일한 주문이 시스템 오류로 여러 번 등록

        **개선 방안**:
        - UNIQUE 제약 조건 설정
        - 중복 제거 배치 작업
        - 입력 시 중복 검증 로직 추가
        """)

    # 일관성
    with st.expander("📌 4. 일관성 (Consistency)"):
        st.markdown("""
        **정의**: 동일한 의미의 데이터가 다양한 시스템에서 일관되게 표현되는 정도

        **측정 항목**:
        - 코드값 일관성
        - 데이터 타입 일관성
        - 명명 규칙 준수
        - 날짜 형식 통일

        **진단 방법**:
        - 표준 코드 준수율
        - 형식 불일치 비율
        - 중복 데이터 정합성

        **실무 예시**:
        ✅ **좋은 사례**: 성별 코드를 전 시스템에서 'M'/'F'로 통일
        ❌ **나쁜 사례**: 성별을 '남'/'여', 'M'/'F', '1'/'2' 등 혼용

        **개선 방안**:
        - 표준 코드 정의 및 적용
        - 데이터 사전 관리
        - 명명 규칙 수립
        """)

    # 정확성
    with st.expander("📌 5. 정확성 (Accuracy)"):
        st.markdown("""
        **정의**: 실제 세계의 값과 일치하는 정도

        **측정 항목**:
        - 범위 유효성 (예: 나이 0-150)
        - 형식 정확성 (예: 이메일 형식)
        - 업무규칙 준수
        - 참조 무결성

        **진단 방법**:
        - 도메인 정확성 검사
        - 업무규칙 위반 검출
        - 이상치(Outlier) 탐지

        **실무 예시**:
        ✅ **좋은 사례**: 나이가 0-120 범위 내, 이메일이 올바른 형식
        ❌ **나쁜 사례**: 나이가 -5세 또는 250세, 이메일이 'invalid-email'

        **개선 방안**:
        - 입력 검증 로직 강화
        - CHECK 제약 조건 설정
        - 업무규칙 문서화 및 자동 검증
        """)

    # 적시성
    with st.expander("📌 6. 적시성 (Timeliness)"):
        st.markdown("""
        **정의**: 데이터가 최신 정보를 반영하고 있는 정도

        **측정 항목**:
        - 데이터 최신성 (마지막 수정일 기준)
        - 갱신 주기 준수
        - 미래/과거 날짜 오류

        **진단 방법**:
        - 경과 일수 = 현재 날짜 - 최종 수정일
        - 갱신 주기 불규칙성 검사
        - 미래 날짜 존재 여부

        **실무 예시**:
        ✅ **좋은 사례**: 재고 데이터가 실시간으로 업데이트됨
        ❌ **나쁜 사례**: 2020년 이후 갱신되지 않은 고객 정보

        **개선 방안**:
        - 자동 갱신 프로세스 구축
        - 갱신 주기 모니터링
        - 타임스탬프 관리 강화
        """)

    # 보안성
    with st.expander("📌 7. 보안성 (Security)"):
        st.markdown("""
        **정의**: 데이터가 무단 접근 및 침해로부터 보호되는 정도

        **측정 항목**:
        - 개인정보 암호화 여부
        - 접근 권한 설정
        - 민감정보 노출

        **진단 방법**:
        - 개인정보 패턴 탐지
        - 민감정보 식별
        - 암호화 필요 데이터 검출

        **실무 예시**:
        ✅ **좋은 사례**: 주민번호, 카드번호 등이 암호화되어 저장
        ❌ **나쁜 사례**: 개인정보가 평문으로 노출

        **개선 방안**:
        - 개인정보 암호화
        - 접근 권한 관리 강화
        - 마스킹 처리
        """)

    # 유용성
    with st.expander("📌 8. 유용성 (Usability)"):
        st.markdown("""
        **정의**: 데이터가 사용자에게 유용하고 효율적인 정도

        **측정 항목**:
        - 데이터 충분성 (레코드 수)
        - 컬럼 유용성 (채워짐 비율)
        - 데이터 다양성 (카디널리티)

        **진단 방법**:
        - 레코드 수 충분성 검사
        - 컬럼별 채워짐 비율
        - 고유값 분포 분석

        **실무 예시**:
        ✅ **좋은 사례**: 충분한 데이터로 통계 분석 가능
        ❌ **나쁜 사례**: 데이터가 10건뿐이라 분석 불가

        **개선 방안**:
        - 데이터 수집 확대
        - 불필요한 컬럼 제거
        - 데이터 품질 모니터링
        """)

    # 3. 4대 진단 방법
    st.header("3️⃣ 4대 진단 방법")

    st.markdown("""
    데이터 품질을 체계적으로 진단하기 위한 4가지 방법론입니다.
    """)

    # 프로파일링
    with st.expander("🔍 1. 프로파일링 (Profiling)"):
        st.markdown("""
        **정의**: 데이터의 통계적 특성과 구조를 분석

        **구성**:
        - **값 진단 (Value Profiling)**: 통계적 특성 분석
        - **구조 진단 (Structure Profiling)**: 메타데이터 분석

        **측정 항목**:
        - 결측치 수/비율
        - 고유값 수
        - 데이터 타입
        - 패턴 분석 (Z-score)
        - 컬럼 길이

        **실무 활용**:
        ```
        컬럼명: 고객나이
        - 총 행 수: 1,000
        - 결측치: 50 (5%)
        - 고유값: 65
        - 평균: 35.2세
        - 이상치: 3건 (-5, 150, 250)
        ```

        **도구**: pandas profiling, ydata-profiling 등
        """)

    # 업무규칙 진단
    with st.expander("📋 2. 업무규칙 진단 (Business Rule Diagnosis)"):
        st.markdown("""
        **정의**: 비즈니스 로직과 정책에 따른 데이터 검증

        **특징**:
        - 도메인 지식 기반
        - 법규/정책 준수 확인
        - 조직 고유 규칙 적용

        **업무규칙 예시**:
        1. 주문 수량은 0 이상이어야 함
        2. 나이는 0-150 범위여야 함
        3. 가입일은 현재 날짜 이전이어야 함
        4. 총액 = 단가 × 수량
        5. 할인율은 0-100% 범위

        **측정 방법**:
        ```python
        오류율 = (규칙 위반 건수 / 전체 건수) × 100%
        ```

        **문서화 필요**:
        - 규칙 정의
        - 법적 근거
        - 검증 로직
        - 예외 처리
        """)

    # 체크리스트
    with st.expander("✅ 3. 체크리스트 (Checklist)"):
        st.markdown("""
        **정의**: 표준 기준에 대한 항목별 검증

        **특징**:
        - 빠른 품질 점검
        - 표준화된 검증
        - PASS/FAIL 판정

        **체크 항목 예시**:
        - ☑️ 결측치 확인
        - ☑️ 고유값 확인
        - ☑️ 데이터 유형 확인
        - ☑️ 표준 준수 확인
        - ☑️ 명명 규칙 확인

        **활용**:
        - 정기 품질 점검
        - 데이터 인수 검수
        - 마이그레이션 전후 검증

        **장점**:
        - 빠른 진단
        - 일관된 기준
        - 추적 가능성
        """)

    # 비정형 실측
    with st.expander("🔍 4. 비정형 실측 (Unstructured Real-time Measurement)"):
        st.markdown("""
        **정의**: 비정형 데이터의 실시간 품질 분석

        **대상**:
        - 이미지 데이터
        - 텍스트 데이터
        - 동영상 데이터
        - 음성 데이터

        **측정 항목**:
        - 이상치 탐지 (IQR, Z-score)
        - 파일 크기/형식
        - 해상도/품질
        - 메타데이터 정합성

        **IQR 방법**:
        ```
        Q1 = 25% 분위수
        Q3 = 75% 분위수
        IQR = Q3 - Q1

        이상치 범위:
        - 하한: Q1 - 1.5 × IQR
        - 상한: Q3 + 1.5 × IQR
        ```

        **실무 활용**:
        - 실시간 품질 모니터링
        - 예외 상황 탐지
        - 패턴 분석
        """)

    # 4. 품질 관리 프로세스
    st.header("4️⃣ 데이터 품질 관리 프로세스")

    st.markdown("""
    ### PDCA 사이클

    ```
    Plan (계획) → Do (실행) → Check (점검) → Act (개선)
    ```

    **1. Plan (계획)**
    - 품질 목표 수립
    - 품질 지표 정의
    - 측정 방법 결정

    **2. Do (실행)**
    - 데이터 수집
    - 품질 진단 실행
    - 결과 기록

    **3. Check (점검)**
    - 진단 결과 분석
    - 이슈 식별
    - 원인 파악

    **4. Act (개선)**
    - 개선 계획 수립
    - 시정 조치 실행
    - 프로세스 개선
    """)

    # 5. 실무 적용 가이드
    st.header("5️⃣ 실무 적용 가이드")

    st.markdown("""
    ### 📝 데이터 품질 관리 체크리스트

    #### 준비 단계
    - [ ] 품질 관리 정책 수립
    - [ ] 담당 조직/인력 지정
    - [ ] 표준 문서 정의
    - [ ] 진단 도구 선정

    #### 진단 단계
    - [ ] 진단 범위 설정
    - [ ] 샘플링 기준 결정
    - [ ] 7대 지표 측정
    - [ ] 4대 방법 적용

    #### 분석 단계
    - [ ] 이슈 우선순위 결정
    - [ ] 근본 원인 분석
    - [ ] 영향도 평가
    - [ ] 개선 방안 도출

    #### 개선 단계
    - [ ] 시정 조치 실행
    - [ ] 프로세스 개선
    - [ ] 모니터링 체계 구축
    - [ ] 정기 점검 수행

    ### 💡 성공 요인

    1. **경영진 지원**: 데이터 품질의 중요성 인식
    2. **조직 문화**: 품질 중심 문화 조성
    3. **전문성**: 데이터 품질 전문가 양성
    4. **자동화**: 품질 진단 자동화
    5. **지속성**: 정기적 모니터링 및 개선

    ### ⚠️ 주의사항

    - 완벽한 품질은 현실적으로 불가능
    - 비용 대비 효과 고려 필요
    - 업무 특성에 맞는 맞춤형 적용
    - 점진적 개선 접근
    - 사용자 관점 중시
    """)

    # 6. 참고 자료
    st.header("6️⃣ 참고 자료")

    st.markdown("""
    ### 📚 국내 표준/지침
    - **공공데이터 품질관리 매뉴얼** (행정안전부)
    - **행정정보 데이터베이스 표준화 지침**
    - **행정기관의 코드표준화 추진지침**
    - **정보기술 아키텍처 도입·운영 지침**

    ### 🌐 국제 표준
    - **ISO/IEC 25012**: 데이터 품질 모델
    - **ISO/IEC 25024**: 데이터 품질 측정
    - **DAMA-DMBOK**: 데이터 관리 지식체계

    ### 🔗 유용한 링크
    - [행정표준코드관리시스템](http://www.code.go.kr)
    - [공공데이터포털](https://www.data.go.kr)
    - [DAMA Korea](http://www.damakorea.org)
    """)

    st.markdown("---")
    st.info("💡 **다음 단계**: '실제 데이터 진단 툴' 탭에서 이론을 실습해보세요!")
